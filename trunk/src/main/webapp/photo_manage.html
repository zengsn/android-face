<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>记脸小程序后台管理系统</title>
    <link rel="stylesheet" href="lib/layui/css/layui.css">
</head>
<body class="layui-layout-body">
<div class="layui-body" style="left: 0px; padding: 15px;">

    <!-- 主题内容 -->
    <div style="line-height: 30px"><h2>相片管理</h2></div>
    <table class="layui-table" lay-size="lg" id="fold-list">
            <!--<tr>-->
                <!--<td style="border-right-width: 0px;border-left-width: 0px;">-->
                    <!--<img src="image/folder-icon.png" alt="" width="30px">-->
                    <!--<a href="pic.html" style="padding-left: 10px">wxid</a>-->
                <!--</td>-->
            <!--</tr>-->

    </table>
    <!-- 分页控件 -->
    <!--<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">-->
        <!--<legend>显示完整功能</legend>-->
    <!--</fieldset>-->
    <div id="pagination"></div>

</div>
<script src="lib/layui/layui.js"></script>
<!-- 引入 jQuery 库 -->
<script src="lib/jQuery/jquery-1.10.1.min.js"></script>

<script>
    var timer = 0;
    var page = 1;       // 设置首页页码
    var limit = 5;      // 设置一页显示的条数
    var total;          // 记录总数

    window.onload = function() {
        loadData();
        // getPage();
    }

    function loadData(){
        $.ajax({
            url:'admin/listUsers',
            type:'post',
            data:{
                index:page,
                limit:limit
            },
            dataType:'json',
            success:function(res){
                total = res.count;
                var str = "<tr>" +
                    "   <td style='border-right-width: 0px;border-left-width: 0px;'>" +
                    "      <span style='padding-left: 40px; '><b>微信昵称</b></span>" +
                    "    </td>" +
                    "    <td style='border-right-width: 0px;border-left-width: 0px;'><b>微信ID</b></td>"+
                    "    <td style='border-right-width: 0px;border-left-width: 0px;'><b>使用磁盘大小</b></td>"+
                    "</tr>";
                for(var i=0; i<res.data.length; i++){
                    str+="<tr>\n" +
                        "    <td style='border-right-width: 0px;border-left-width: 0px;'>\n" +
                        "      <img src='image/folder-icon.png' alt='' width='30px'>\n" +
                        "      <a href='javascript:;' style='padding-left: 10px' onmouseover='come(this)' " +
                        "onmouseleave='leave(this)' onclick='getPhotoByWxid(this,1,5)'>"+ res.data[i].nickName +"</a>" +
                        "    </td>" +
                        "    <td style='border-right-width: 0px;border-left-width: 0px;'>" + res.data[i].wxid + "</td>"+
                        "    <td style='border-right-width: 0px;border-left-width: 0px;'>" + res.data[i].size + "</td>"+
                        "</tr>"
                }
                $('#fold-list').html(str);

                if(timer == 0){
                    getPage();
                    timer = -1;
                }

            }
        })
        console.log("loading...")
    }

    // 跳转页面, 根据微信id获取照片
    function getPhotoByWxid(obj, index, limitNum) {
        var temp = obj;
        var wxid = obj.parentNode.nextSibling.nextSibling.innerHTML;        // 微信的id
        console.log(wxid);
        window.location.href = 'photo_detail.html?wxid=' + wxid;
    }

    // 链接获得焦点变成蓝色
    function come(obj) {
        obj.style.color="blue"
    }
    // 链接失去焦点恢复为黑色
    function leave(obj) {
        obj.style.color="black"
    }

    // 加载页面
    function getPage() {
        layui.use('laypage', function () {
            var laypage = layui.laypage;

            // 使用 layui 的分页插件
            // 执行一个laypage实例
            laypage.render({
                elem: 'pagination',     // 注意，这里的 test1 是 ID，不用加 # 号
                count: total,           // 数据总数，从服务端得到
                limit: limit,           // 每页条数设置
                jump: function (obj, first) {
                    //obj包含了当前分页的所有参数，比如：
                    console.log("得到当前页" + obj.curr);      // 得到当前页，以便向服务端请求对应页的数据。
                    // console.log(obj.limit);     // 得到每页显示的条数
                    page = obj.curr;            // 改变当前页码
                    limit = obj.limit;          // 改变一页显示的数据条数

                    //首次不执行
                    if (!first) {
                        loadData()  //加载数据
                    }
                }
            });
        });
    }



</script>
</body>
</html>